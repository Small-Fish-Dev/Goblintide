@using GoblinGame.UI.Core
@using GoblinGame.UpgradeSystem
@using Sandbox.UI;

@namespace GoblinGame.UI
@inherits Actor
@attribute [StyleSheet( "/UI/SkillTree/UpgradeActor.scss" )]

<root>
	<img src="@Upgrade.Texture"/>
</root>

@code {

	public Upgrade Upgrade { get; }

	public bool Available => 0 < Goblintide.TotalIQ && !Purchased && Dependencies.All( v => v.Purchased );
	public bool Purchased => Lord.Self.HasUpgrade( Upgrade.Identifier );
	public bool Expensive => 1 > Goblintide.TotalIQ && !Purchased;

	protected override float WobbleDelay => Available ? 0.4f : 0.9f;
	protected override float WobbleAmount => Available ? 3 : 2;

	// Generated by SkillTree
	public readonly List<UpgradeActor> Dependencies = new();

	public UpgradeActor( PanelCamera camera, Upgrade upgrade ) : base( camera ) => Upgrade = upgrade;

	protected override Vector2 ModifyInitialPosition( Vector2 position ) => position + Upgrade.Position;

	public override void Tick()
	{
		base.Tick();

		SetClass( "available", Available );
		SetClass( "purchased", Purchased );
		SetClass( "expensive", Expensive );
	}

	protected override void OnClick( MousePanelEvent e )
	{
		base.OnClick( e );

		((SkillTree)SkillTree.Instance).Select( this );
	}

}
